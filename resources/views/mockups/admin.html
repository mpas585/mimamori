<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®¡ç†ç”»é¢ - ã¿ã¾ã‚‚ã‚Šãƒ‡ãƒã‚¤ã‚¹ï¼ˆä»®ï¼‰</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
:root {
  --white: #ffffff; --cream: #faf9f7; --beige: #f5f3ef;
  --gray-100: #f0eeea; --gray-200: #e5e2dc; --gray-300: #d1ccc3;
  --gray-400: #a8a29e; --gray-500: #78716c; --gray-600: #57534e;
  --gray-700: #44403c; --gray-800: #292524;
  --green-light: #dcfce7; --green: #22c55e; --green-dark: #16a34a;
  --yellow-light: #fef9c3; --yellow: #eab308;
  --red-light: #fee2e2; --red: #ef4444;
  --blue-light: #dbeafe; --blue: #3b82f6;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.04); --shadow: 0 4px 20px rgba(0,0,0,0.06);
  --radius: 8px; --radius-lg: 12px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans JP', sans-serif; background: var(--cream); color: var(--gray-800); min-height: 100vh; line-height: 1.7; }

.header { background: var(--white); border-bottom: 1px solid var(--gray-100); position: sticky; top: 0; z-index: 100; }
.header-inner { max-width: 1200px; margin: 0 auto; padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; }
.header-left { display: flex; align-items: center; gap: 20px; }
.header-logo { display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit; }
.header-logo-icon { width: 36px; height: 36px; background: var(--cream); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
.header-logo-text { font-size: 16px; font-weight: 500; }
.header-org { font-size: 14px; color: var(--gray-500); padding-left: 20px; border-left: 1px solid var(--gray-200); }
.header-btn { padding: 8px 12px; font-size: 13px; color: var(--gray-600); background: transparent; border: none; border-radius: var(--radius); cursor: pointer; transition: all 0.2s; text-decoration: none; }
.header-btn:hover { background: var(--beige); color: var(--gray-800); }

.container { max-width: 1200px; margin: 0 auto; padding: 24px; }

.pwa-float { background: var(--blue-light); border: 1px solid #bfdbfe; border-radius: var(--radius-lg); padding: 12px 20px; display: flex; align-items: center; gap: 16px; margin-bottom: 20px; animation: fadeIn 0.4s ease; }
.pwa-float.hidden { display: none; }
.pwa-float-text { display: flex; align-items: center; gap: 10px; flex: 1; }
.pwa-float-text span { font-size: 18px; }
.pwa-float-text p { font-size: 14px; font-weight: 500; color: var(--gray-700); }
.pwa-float-btn { padding: 8px 16px; font-size: 13px; font-weight: 600; color: var(--white); background: var(--blue); border: none; border-radius: var(--radius); cursor: pointer; transition: all 0.2s; white-space: nowrap; }
.pwa-float-btn:hover { opacity: 0.9; }
.pwa-float-close { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: transparent; border: none; border-radius: 50%; cursor: pointer; font-size: 18px; color: var(--gray-500); transition: all 0.2s; flex-shrink: 0; }
.pwa-float-close:hover { background: rgba(0,0,0,0.1); color: var(--gray-700); }

.summary-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 28px; animation: fadeIn 0.4s ease; }
.summary-card { background: var(--white); border-radius: var(--radius-lg); padding: 20px; box-shadow: var(--shadow-sm); text-align: center; transition: all 0.2s; border: 1px solid var(--gray-200); }
.summary-card:hover { box-shadow: var(--shadow); transform: translateY(-2px); }
.summary-count { font-size: 36px; font-weight: 700; margin-bottom: 4px; }
.summary-count.ok { color: var(--green); }
.summary-count.warning { color: var(--yellow); }
.summary-count.error { color: var(--red); }
.summary-count.offline { color: var(--gray-400); }
.summary-count.vacant { color: var(--gray-300); }
.summary-label { font-size: 13px; font-weight: 600; color: var(--gray-600); }

.alert-bar { background: var(--red-light); border: 1px solid #fecaca; border-left: 4px solid var(--red); padding: 14px 20px; margin-bottom: 24px; border-radius: var(--radius); display: flex; align-items: center; justify-content: space-between; }
.alert-bar.hidden { display: none; }
.alert-content { display: flex; align-items: center; gap: 12px; }
.alert-icon { font-size: 20px; }
.alert-text { font-size: 14px; font-weight: 500; }
.alert-text strong { color: var(--red); font-weight: 700; }
.alert-action { padding: 8px 16px; font-size: 13px; font-weight: 600; font-family: inherit; border: none; border-radius: var(--radius); background: var(--red); color: var(--white); cursor: pointer; transition: all 0.2s; }
.alert-action:hover { opacity: 0.9; }

.toolbar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; gap: 16px; flex-wrap: wrap; }
.toolbar-left { display: flex; align-items: center; gap: 12px; }
.search-box { display: flex; align-items: center; background: var(--white); border: 1px solid var(--gray-300); border-radius: var(--radius); padding: 0 12px; width: 280px; }
.search-box:focus-within { border-color: var(--gray-500); box-shadow: 0 0 0 3px rgba(168, 162, 158, 0.15); }
.search-box input { flex: 1; padding: 10px 8px; border: none; background: transparent; font-size: 14px; font-family: inherit; }
.search-box input:focus { outline: none; }
.search-box span { color: var(--gray-400); }
.filter-select { padding: 10px 14px; font-size: 14px; font-family: inherit; border: 1px solid var(--gray-300); border-radius: var(--radius); background: var(--white); color: var(--gray-700); cursor: pointer; font-weight: 500; }
.toolbar-right { display: flex; align-items: center; gap: 8px; }
.toolbar-btn { padding: 10px 16px; font-size: 13px; font-weight: 600; font-family: inherit; border: 1px solid var(--gray-300); border-radius: var(--radius); background: var(--white); color: var(--gray-700); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
.toolbar-btn:hover { background: var(--beige); border-color: var(--gray-400); }

.table-card { background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); overflow: hidden; border: 1px solid var(--gray-200); animation: fadeIn 0.4s ease 0.1s both; }
.table-wrapper { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; font-size: 14px; }
thead { background: var(--beige); }
th { padding: 14px 16px; text-align: left; font-weight: 600; color: var(--gray-700); white-space: nowrap; border-bottom: 2px solid var(--gray-300); border-right: 1px solid var(--gray-200); }
th:last-child { border-right: none; }
td { padding: 14px 16px; border-bottom: 1px solid var(--gray-200); border-right: 1px solid var(--gray-100); vertical-align: middle; }
td:last-child { border-right: none; }
tbody tr:nth-child(odd) { background: var(--white); }
tbody tr:nth-child(even) { background: var(--cream); }
tbody tr:hover { background: var(--gray-100); }
tbody tr:last-child td { border-bottom: none; }

.status-badge { display: inline-flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; }
.status-dot { width: 12px; height: 12px; border-radius: 50%; position: relative; }
.status-dot.ok { background: var(--green); }
.status-dot.warning { background: var(--yellow); }
.status-dot.error { background: var(--red); }
.status-dot.offline { background: var(--gray-400); }
.status-dot.vacant { background: var(--gray-300); border: 2px solid var(--gray-200); }
.status-dot.ok::before { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 50%; border: 2px solid var(--green); animation: radar-pulse-sm 3.5s ease-out infinite; }
@keyframes radar-pulse-sm { 0% { width: 8px; height: 8px; opacity: 0.6; } 100% { width: 24px; height: 24px; opacity: 0; } }

.room-cell { display: flex; flex-direction: column; }
.room-number { font-weight: 700; color: var(--gray-800); }
.room-name { font-size: 12px; color: var(--gray-500); font-weight: 500; }
.mono { font-family: monospace; }

.battery-bar { width: 60px; height: 10px; background: var(--gray-200); border-radius: 5px; overflow: hidden; display: inline-block; margin-right: 8px; vertical-align: middle; border: 1px solid var(--gray-300); }
.battery-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
.battery-fill.high { background: var(--green); }
.battery-fill.medium { background: var(--yellow); }
.battery-fill.low { background: var(--red); }
.battery-text { font-size: 13px; font-weight: 600; color: var(--gray-700); }
.battery-svg { display: inline-block; vertical-align: middle; margin-right: 6px; }

.time-ago { color: var(--gray-600); font-weight: 500; }
.time-ago.recent { color: var(--green-dark); font-weight: 600; }
.time-ago.old { color: var(--red); font-weight: 600; }

.action-btn { padding: 6px 12px; font-size: 12px; font-weight: 600; font-family: inherit; border: 1px solid var(--gray-300); border-radius: 4px; background: var(--white); color: var(--gray-700); cursor: pointer; transition: all 0.2s; margin-right: 4px; }
.action-btn:hover { background: var(--beige); }
.action-btn.delete-btn { color: var(--red); border-color: #fecaca; }
.action-btn.delete-btn:hover { background: var(--red-light); }

.device-count { font-size: 13px; color: var(--gray-600); font-weight: 500; }
.device-count strong { color: var(--gray-800); font-weight: 700; }

.signal-svg { display: inline-block; vertical-align: middle; margin-right: 6px; }
.signal-text { font-size: 12px; font-weight: 500; color: var(--gray-600); }
.meter-svg { display: inline-block; vertical-align: middle; margin-right: 6px; }
.meter-text { font-size: 12px; font-weight: 600; color: var(--gray-700); }

th.sortable { cursor: pointer; user-select: none; transition: background 0.2s; }
th.sortable:hover { background: var(--gray-100); }
.sort-icon { font-size: 12px; color: var(--gray-400); margin-left: 4px; }
th.sorted-asc .sort-icon, th.sorted-desc .sort-icon { color: var(--gray-700); }

/* è¦‹å®ˆã‚Šãƒˆã‚°ãƒ«ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ç”¨å°å‹ç‰ˆï¼‰ */
.watch-toggle-sm { position: relative; width: 40px; height: 22px; background: var(--gray-300); border-radius: 11px; cursor: pointer; transition: all 0.2s; border: none; }
.watch-toggle-sm.active { background: var(--green); }
.watch-toggle-sm::after { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: var(--white); border-radius: 50%; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
.watch-toggle-sm.active::after { left: 20px; }
.watch-toggle-sm.disabled { opacity: 0.5; cursor: not-allowed; }

/* ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º */
.watch-cell { display: flex; align-items: center; gap: 6px; }
.timer-badge { font-size: 14px; cursor: help; animation: pulse-timer 2s infinite; }
@keyframes pulse-timer { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

/* ã‚¿ã‚¤ãƒãƒ¼ä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« */
.timer-list { list-style: none; }
.timer-list-item { display: flex; align-items: center; padding: 14px; background: var(--white); border-bottom: 1px solid var(--gray-100); }
.timer-list-item:last-child { border-bottom: none; }
.timer-list-item:nth-child(even) { background: var(--cream); }
.timer-list-room { width: 100px; }
.timer-list-room-num { font-weight: 700; color: var(--gray-800); }
.timer-list-room-name { font-size: 12px; color: var(--gray-500); }
.timer-list-info { flex: 1; }
.timer-list-schedule { font-size: 14px; font-weight: 600; color: var(--gray-800); margin-bottom: 2px; }
.timer-list-memo { font-size: 12px; color: var(--gray-500); }
.timer-list-type { font-size: 11px; font-weight: 600; padding: 4px 8px; border-radius: 4px; margin-right: 8px; }
.timer-list-type.oneshot { background: var(--yellow-light); color: var(--gray-700); }
.timer-list-type.recurring { background: var(--blue-light); color: var(--blue); }
.timer-list-delete { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: transparent; border: none; border-radius: 4px; cursor: pointer; color: var(--gray-400); font-size: 16px; transition: all 0.2s; }
.timer-list-delete:hover { background: var(--red-light); color: var(--red); }

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 1000; padding: 20px; }
.modal-overlay.show { display: flex; align-items: center; justify-content: center; }
.modal { background: var(--white); width: 100%; max-width: 480px; border-radius: var(--radius-lg); overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
.modal.wide { max-width: 560px; }
.modal-header { padding: 20px; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; }
.modal-header h3 { font-size: 16px; font-weight: 600; }
.modal-close { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: var(--beige); border: none; border-radius: 6px; cursor: pointer; font-size: 18px; }
.modal-close:hover { background: var(--gray-200); }
.modal-body { padding: 20px; max-height: 70vh; overflow-y: auto; }
.modal-footer { padding: 16px 20px; border-top: 1px solid var(--gray-200); display: flex; gap: 12px; justify-content: flex-end; }
.form-group { margin-bottom: 16px; }
.form-label { display: block; font-size: 13px; font-weight: 600; color: var(--gray-700); margin-bottom: 6px; }
.form-input { width: 100%; padding: 12px 14px; font-size: 14px; font-family: inherit; border: 1px solid var(--gray-300); border-radius: var(--radius); background: var(--cream); }
.form-input:focus { outline: none; border-color: var(--gray-500); background: var(--white); }
.form-hint { font-size: 12px; color: var(--gray-500); margin-top: 4px; }
.btn { padding: 12px 20px; font-size: 14px; font-weight: 600; font-family: inherit; border: none; border-radius: var(--radius); cursor: pointer; transition: all 0.2s; }
.btn-primary { background: var(--gray-800); color: var(--white); }
.btn-primary:hover { background: var(--gray-700); }
.btn-secondary { background: var(--beige); color: var(--gray-700); border: 1px solid var(--gray-300); }
.btn-secondary:hover { background: var(--gray-200); }
.btn-danger { background: var(--red); color: var(--white); }
.btn-danger:hover { opacity: 0.9; }
.btn-success { background: var(--green); color: var(--white); }
.btn-success:hover { background: var(--green-dark); }

/* è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ */
.detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.detail-item { padding: 14px; background: var(--beige); border-radius: var(--radius); }
.detail-item.full { grid-column: 1 / -1; }
.detail-item-label { font-size: 12px; color: var(--gray-500); margin-bottom: 4px; }
.detail-item-value { font-size: 16px; font-weight: 600; color: var(--gray-800); display: flex; align-items: center; gap: 6px; }
.detail-item-value.mono { font-family: monospace; letter-spacing: 0.05em; }
.detail-item-value.ok { color: var(--green-dark); }
.detail-item-value.warning { color: var(--yellow); }
.detail-item-value.error { color: var(--red); }

.detail-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--gray-200); }
.detail-section-title { font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; }
.detail-section-title span { display: flex; align-items: center; gap: 8px; }

.detail-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--gray-100); }
.detail-row:last-child { border-bottom: none; }
.detail-row-label { font-size: 14px; color: var(--gray-600); }
.detail-row-value { font-size: 14px; font-weight: 600; color: var(--gray-800); }

.status-large { display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--green-light); border-radius: var(--radius); margin-bottom: 20px; }
.status-large.warning { background: var(--yellow-light); }
.status-large.error { background: var(--red-light); }
.status-large.offline { background: var(--gray-100); }
.status-large-dot { width: 16px; height: 16px; border-radius: 50%; background: var(--green); }
.status-large.warning .status-large-dot { background: var(--yellow); }
.status-large.error .status-large-dot { background: var(--red); }
.status-large.offline .status-large-dot { background: var(--gray-400); }
.status-large-text { font-size: 15px; font-weight: 600; }

.pagination { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-top: 2px solid var(--gray-200); background: var(--cream); }
.pagination-info { font-size: 13px; font-weight: 500; color: var(--gray-600); }
.pagination-buttons { display: flex; gap: 4px; }
.page-btn { min-width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; font-family: inherit; border: 1px solid var(--gray-300); border-radius: var(--radius); background: var(--white); color: var(--gray-700); cursor: pointer; transition: all 0.2s; }
.page-btn:hover { background: var(--beige); }
.page-btn.active { background: var(--gray-800); color: var(--white); border-color: var(--gray-800); }
.page-btn:disabled { opacity: 0.5; cursor: not-allowed; }

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‡¡ä¾‹ */
.status-legend { display: flex; gap: 20px; margin-bottom: 16px; font-size: 12px; color: var(--gray-600); flex-wrap: wrap; }
.legend-item { display: flex; align-items: center; gap: 6px; }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; }
.legend-dot.ok { background: var(--green); }
.legend-dot.warning { background: var(--yellow); }
.legend-dot.error { background: var(--red); }
.legend-dot.offline { background: var(--gray-400); }
.legend-dot.vacant { background: var(--gray-300); border: 1px solid var(--gray-200); }

/* ã‚¿ã‚¤ãƒãƒ¼è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ */
.timer-tabs { display: flex; gap: 4px; background: var(--beige); padding: 4px; border-radius: var(--radius); margin-bottom: 20px; }
.timer-tab { flex: 1; padding: 10px 16px; font-size: 13px; font-weight: 600; text-align: center; color: var(--gray-500); background: transparent; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
.timer-tab.active { background: var(--white); color: var(--gray-800); box-shadow: var(--shadow-sm); }
.timer-tab:not(.active):hover { color: var(--gray-700); }
.timer-content { display: none; }
.timer-content.active { display: block; }

/* æ›œæ—¥é¸æŠ */
.weekday-selector { display: flex; gap: 6px; margin-bottom: 16px; }
.weekday-btn { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; color: var(--gray-500); background: var(--cream); border: 1px solid var(--gray-200); border-radius: var(--radius); cursor: pointer; transition: all 0.2s; }
.weekday-btn:hover { border-color: var(--gray-400); color: var(--gray-700); }
.weekday-btn.selected { background: var(--gray-800); color: var(--white); border-color: var(--gray-800); }
.weekday-btn.sun { color: var(--red); }
.weekday-btn.sun.selected { background: var(--red); border-color: var(--red); color: var(--white); }
.weekday-btn.sat { color: var(--blue); }
.weekday-btn.sat.selected { background: var(--blue); border-color: var(--blue); color: var(--white); }

/* æ™‚é–“å…¥åŠ› */
.time-row { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
.time-row input[type="time"] { flex: 1; padding: 10px 12px; font-size: 14px; font-family: inherit; border: 1px solid var(--gray-300); border-radius: var(--radius); background: var(--cream); }
.time-row input[type="time"]:focus { outline: none; border-color: var(--gray-500); background: var(--white); }
.time-row span { color: var(--gray-500); font-size: 14px; }

/* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
.checkbox-row { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }
.checkbox-row input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--gray-800); cursor: pointer; }
.checkbox-row label { font-size: 13px; color: var(--gray-700); cursor: pointer; }

/* ã‚¿ã‚¤ãƒãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆè©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ï¼‰ */
.timer-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--gray-100); }
.timer-item:last-child { border-bottom: none; }
.timer-item-info { flex: 1; }
.timer-item-type { font-size: 12px; color: var(--gray-500); }
.timer-item-schedule { font-size: 14px; font-weight: 600; color: var(--gray-800); }
.timer-item-memo { font-size: 12px; color: var(--gray-500); }
.timer-item-delete { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: transparent; border: none; border-radius: 4px; cursor: pointer; color: var(--gray-400); font-size: 16px; transition: all 0.2s; }
.timer-item-delete:hover { background: var(--red-light); color: var(--red); }

/* è¿½åŠ ãƒœã‚¿ãƒ³å° */
.btn-add-sm { padding: 6px 12px; font-size: 12px; font-weight: 600; font-family: inherit; border: 1px solid var(--gray-300); border-radius: 4px; background: var(--white); color: var(--gray-700); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 4px; }
.btn-add-sm:hover { background: var(--beige); }

/* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
.toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-20px); background: var(--gray-800); color: var(--white); padding: 12px 24px; border-radius: var(--radius); font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 2000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
.toast.show { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
.toast-icon { color: var(--green); }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@media (max-width: 900px) {
  .summary-grid { grid-template-columns: repeat(3, 1fr); }
  .toolbar { flex-direction: column; align-items: stretch; }
  .toolbar-left, .toolbar-right { width: 100%; flex-wrap: wrap; }
  .search-box { width: 100%; }
  .device-count { width: 100%; text-align: right; margin-top: 8px; }
}
@media (max-width: 600px) {
  .header-org { display: none; }
  .summary-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
  .summary-card { padding: 16px; }
  .summary-count { font-size: 28px; }
  .detail-grid { grid-template-columns: 1fr; }
  .weekday-selector { flex-wrap: wrap; }
}
  </style>
</head>
<body>
  <!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ -->
  <div id="toast" class="toast">
    <span class="toast-icon">âœ“</span>
    <span id="toastText">ä¿å­˜ã—ã¾ã—ãŸ</span>
  </div>

  <header class="header">
    <div class="header-inner">
      <div class="header-left">
        <a href="admin.html" class="header-logo">
          <div class="header-logo-icon"></div>
          <span class="header-logo-text">ã¿ã¾ã‚‚ã‚Šãƒ‡ãƒã‚¤ã‚¹ï¼ˆä»®ï¼‰</span>
        </a>
        <span class="header-org">ã€‡ã€‡ãƒãƒ³ã‚·ãƒ§ãƒ³ ç®¡ç†ç”»é¢</span>
      </div>
      <div style="display: flex; align-items: center; gap: 8px;">
        <a href="admin-password-change.html" class="header-btn">ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</a>
        <a href="admin-login.html" class="header-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- PWAãƒãƒŠãƒ¼ -->
    <div id="pwaBanner" class="pwa-float">
      <div class="pwa-float-text">
        <span>ğŸ“±</span>
        <p>ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™</p>
      </div>
      <button class="pwa-float-btn">è¿½åŠ ã™ã‚‹</button>
      <button class="pwa-float-close" onclick="closePwaBanner()">Ã—</button>
    </div>

    <!-- å¥‘ç´„æƒ…å ± -->
    <div style="background: var(--white); border-radius: 12px; padding: 16px 20px; margin-bottom: 20px; border: 1px solid var(--gray-200); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;">
      <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
        <div>
          <span style="font-size: 12px; color: var(--gray-500);">å¥‘ç´„ãƒ—ãƒ©ãƒ³</span>
          <p style="font-size: 15px; font-weight: 600;">ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ï¼ˆ45å°ï¼‰</p>
        </div>
        <div style="padding-left: 16px; border-left: 1px solid var(--gray-200);">
          <span style="font-size: 12px; color: var(--gray-500);">æœ‰åŠ¹æœŸé™</span>
          <p style="font-size: 15px; font-weight: 600; color: var(--green-dark);">2025/12/31 <span style="font-size: 12px; font-weight: 500; color: var(--gray-500);">ï¼ˆã‚ã¨345æ—¥ï¼‰</span></p>
        </div>
      </div>
      <div style="font-size: 13px; color: var(--gray-500);">
        ã”å¥‘ç´„ã«é–¢ã™ã‚‹ãŠå•ã„åˆã‚ã›ã¯ç®¡ç†ä¼šç¤¾ã¾ã§
      </div>
    </div>

    <!-- è­¦å‘Šã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒ¼ï¼ˆæœªæ¤œçŸ¥ï¼‰ -->
    <div class="alert-bar" id="alertBar">
      <div class="alert-content">
        <span class="alert-icon">ğŸ”´</span>
        <span class="alert-text"><strong>1ä»¶</strong>ã®ãƒ‡ãƒã‚¤ã‚¹ã§24æ™‚é–“ä»¥ä¸Šæ¤œçŸ¥ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆè¦ç¢ºèªï¼‰</span>
      </div>
      <button class="alert-action">ç¢ºèªã™ã‚‹</button>
    </div>

    <!-- é€šä¿¡é€”çµ¶ã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒ¼ -->
    <div class="alert-bar" id="offlineAlert" style="background: var(--gray-100); border-color: var(--gray-300); border-left-color: var(--gray-400);">
      <div class="alert-content">
        <span class="alert-icon">âš«</span>
        <span class="alert-text" style="color: var(--gray-700);"><strong style="color: var(--gray-600);">1ä»¶</strong>ã®ãƒ‡ãƒã‚¤ã‚¹ãŒ48æ™‚é–“ä»¥ä¸Šé€šä¿¡ã—ã¦ã„ã¾ã›ã‚“ï¼ˆé›»æ³¢éšœå®³ã¾ãŸã¯é›»æ± åˆ‡ã‚Œã®å¯èƒ½æ€§ï¼‰</span>
      </div>
      <button class="alert-action" style="background: var(--gray-600);">ç¢ºèªã™ã‚‹</button>
    </div>

    <div class="summary-grid">
      <div class="summary-card"><p class="summary-count ok">40</p><p class="summary-label">ğŸŸ¢ æ­£å¸¸</p></div>
      <div class="summary-card"><p class="summary-count warning">2</p><p class="summary-label">ğŸŸ¡ æ³¨æ„</p></div>
      <div class="summary-card"><p class="summary-count error">1</p><p class="summary-label">ğŸ”´ è­¦å‘Š</p></div>
      <div class="summary-card"><p class="summary-count offline">1</p><p class="summary-label">âš« é›¢ç·š</p></div>
      <div class="summary-card"><p class="summary-count vacant">1</p><p class="summary-label">âšª ç©ºå®¤</p></div>
    </div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‡¡ä¾‹ -->
    <div class="status-legend">
      <div class="legend-item"><span class="legend-dot ok"></span>æ­£å¸¸: æ¤œçŸ¥ã‚ã‚Š</div>
      <div class="legend-item"><span class="legend-dot warning"></span>æ³¨æ„: é›»æ± ä½ä¸‹/æœªæ¤œçŸ¥æ°—å‘³</div>
      <div class="legend-item"><span class="legend-dot error"></span>è­¦å‘Š: é•·æ™‚é–“æœªæ¤œçŸ¥</div>
      <div class="legend-item"><span class="legend-dot offline"></span>é›¢ç·š: é€šä¿¡é€”çµ¶</div>
      <div class="legend-item"><span class="legend-dot vacant"></span>ç©ºå®¤: ãƒ‡ãƒã‚¤ã‚¹æœªå‰²å½“</div>
    </div>

    <div class="toolbar">
      <div class="toolbar-left">
        <div class="search-box"><span>ğŸ”</span><input type="text" placeholder="éƒ¨å±‹ç•ªå·ãƒ»åå‰ã§æ¤œç´¢..."></div>
        <select class="filter-select">
          <option value="">ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
          <option value="ok">ğŸŸ¢ æ­£å¸¸ã®ã¿</option>
          <option value="warning">ğŸŸ¡ æ³¨æ„ã®ã¿</option>
          <option value="error">ğŸ”´ è­¦å‘Šã®ã¿</option>
          <option value="offline">âš« é›¢ç·šã®ã¿</option>
          <option value="vacant">âšª ç©ºå®¤ã®ã¿</option>
        </select>
        <select class="filter-select">
          <option value="">ã™ã¹ã¦ã®è¦‹å®ˆã‚ŠçŠ¶æ…‹</option>
          <option value="watch-on">è¦‹å®ˆã‚ŠON</option>
          <option value="watch-off">è¦‹å®ˆã‚ŠOFF</option>
          <option value="timer">â° ã‚¿ã‚¤ãƒãƒ¼è¨­å®šä¸­</option>
        </select>
        <span class="device-count">ç™»éŒ²: <strong id="deviceCountNum">45</strong> / 100å°</span>
      </div>
      <div class="toolbar-right">
        <button class="toolbar-btn" onclick="showTimerListModal()">â° ã‚¿ã‚¤ãƒãƒ¼ä¸€è¦§</button>
        <button class="toolbar-btn" onclick="showAddDeviceModal()">â• ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ </button>
        <button class="toolbar-btn">ğŸ“¥ CSVå‡ºåŠ›</button>
      </div>
    </div>

    <div class="table-card">
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th class="sortable" onclick="sortTable('status')">çŠ¶æ…‹ <span class="sort-icon">â†•</span></th>
              <th class="sortable sorted-asc" onclick="sortTable('room')">éƒ¨å±‹ / åå‰ <span class="sort-icon">â†‘</span></th>
              <th class="sortable" onclick="sortTable('device')">ãƒ‡ãƒã‚¤ã‚¹ID <span class="sort-icon">â†•</span></th>
              <th>è¦‹å®ˆã‚Š</th>
              <th class="sortable" onclick="sortTable('time')">æœ€çµ‚æ¤œçŸ¥ <span class="sort-icon">â†•</span></th>
              <th class="sortable" onclick="sortTable('battery')">é›»æ±  <span class="sort-icon">â†•</span></th>
              <th class="sortable" onclick="sortTable('signal')">é›»æ³¢ <span class="sort-icon">â†•</span></th>
              <th class="sortable" onclick="sortTable('data')">é€šä¿¡æ®‹é‡ <span class="sort-icon">â†•</span></th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="deviceTableBody">
            <tr>
              <td><span class="status-badge"><span class="status-dot ok"></span>æ­£å¸¸</span></td>
              <td><div class="room-cell"><span class="room-number">101</span><span class="room-name">å±±ç”° å¤ªéƒ</span></div></td>
              <td class="mono">A3K9X2</td>
              <td><button class="watch-toggle-sm active" onclick="toggleDeviceWatch(this, 'A3K9X2')"></button></td>
              <td><span class="time-ago recent">3åˆ†å‰</span></td>
              <td><svg class="battery-svg" width="28" height="14" viewBox="0 0 28 14"><rect x="0" y="1" width="24" height="12" rx="2" fill="none" stroke="#16a34a" stroke-width="1.5"/><rect x="2" y="3" width="17" height="8" rx="1" fill="#22c55e"/><rect x="24" y="4" width="3" height="6" rx="1" fill="#16a34a"/></svg><span class="battery-text">85%</span></td>
              <td><svg class="signal-svg" width="20" height="16" viewBox="0 0 20 16"><rect x="0" y="12" width="4" height="4" rx="1" fill="#22c55e"/><rect x="5" y="8" width="4" height="8" rx="1" fill="#22c55e"/><rect x="10" y="4" width="4" height="12" rx="1" fill="#22c55e"/><rect x="15" y="0" width="4" height="16" rx="1" fill="#22c55e"/></svg><span class="signal-text">è‰¯å¥½</span></td>
              <td><svg class="meter-svg" width="18" height="18" viewBox="0 0 36 36"><circle cx="18" cy="18" r="15" fill="none" stroke="#e5e2dc" stroke-width="4"/><circle cx="18" cy="18" r="15" fill="none" stroke="#22c55e" stroke-width="4" stroke-dasharray="94.2" stroke-dashoffset="0.9" transform="rotate(-90 18 18)" stroke-linecap="round"/></svg><span class="meter-text">99%</span></td>
              <td><button class="action-btn" onclick="showDetailModal('A3K9X2')">è©³ç´°</button><button class="action-btn delete-btn" onclick="confirmDelete('A3K9X2')">å‰Šé™¤</button></td>
            </tr>
            <tr>
              <td><span class="status-badge"><span class="status-dot ok"></span>æ­£å¸¸</span></td>
              <td><div class="room-cell"><span class="room-number">102</span><span class="room-name">ä½è—¤ èŠ±å­</span></div></td>
              <td class="mono">B7X2K9</td>
              <td>
                <div class="watch-cell">
                  <button class="watch-toggle-sm" onclick="toggleDeviceWatch(this, 'B7X2K9')"></button>
                  <span class="timer-badge" title="ã‚¿ã‚¤ãƒãƒ¼è¨­å®šä¸­ï¼šæ¯é€±æœˆæœ¨ 10:00ã€œ16:00">â°</span>
                </div>
              </td>
              <td><span class="time-ago recent">5åˆ†å‰</span></td>
              <td><svg class="battery-svg" width="28" height="14" viewBox="0 0 28 14"><rect x="0" y="1" width="24" height="12" rx="2" fill="none" stroke="#16a34a" stroke-width="1.5"/><rect x="2" y="3" width="14" height="8" rx="1" fill="#22c55e"/><rect x="24" y="4" width="3" height="6" rx="1" fill="#16a34a"/></svg><span class="battery-text">72%</span></td>
              <td><svg class="signal-svg" width="20" height="16" viewBox="0 0 20 16"><rect x="0" y="12" width="4" height="4" rx="1" fill="#22c55e"/><rect x="5" y="8" width="4" height="8" rx="1" fill="#22c55e"/><rect x="10" y="4" width="4" height="12" rx="1" fill="#22c55e"/><rect x="15" y="0" width="4" height="16" rx="1" fill="#22c55e"/></svg><span class="signal-text">è‰¯å¥½</span></td>
              <td><svg class="meter-svg" width="18" height="18" viewBox="0 0 36 36"><circle cx="18" cy="18" r="15" fill="none" stroke="#e5e2dc" stroke-width="4"/><circle cx="18" cy="18" r="15" fill="none" stroke="#22c55e" stroke-width="4" stroke-dasharray="94.2" stroke-dashoffset="1.9" transform="rotate(-90 18 18)" stroke-linecap="round"/></svg><span class="meter-text">98%</span></td>
              <td><button class="action-btn" onclick="showDetailModal('B7X2K9')">è©³ç´°</button><button class="action-btn delete-btn" onclick="confirmDelete('B7X2K9')">å‰Šé™¤</button></td>
            </tr>
            <tr>
              <td><span class="status-badge"><span class="status-dot warning"></span>æ³¨æ„</span></td>
              <td><div class="room-cell"><span class="room-number">103</span><span class="room-name">ç”°ä¸­ æ¬¡éƒ</span></div></td>
              <td class="mono">C4M8P2</td>
              <td><button class="watch-toggle-sm active" onclick="toggleDeviceWatch(this, 'C4M8P2')"></button></td>
              <td><span class="time-ago">45åˆ†å‰</span></td>
              <td><svg class="battery-svg" width="28" height="14" viewBox="0 0 28 14"><rect x="0" y="1" width="24" height="12" rx="2" fill="none" stroke="#eab308" stroke-width="1.5"/><rect x="2" y="3" width="6" height="8" rx="1" fill="#eab308"/><rect x="24" y="4" width="3" height="6" rx="1" fill="#eab308"/></svg><span class="battery-text">28%</span></td>
              <td><svg class="signal-svg" width="20" height="16" viewBox="0 0 20 16"><rect x="0" y="12" width="4" height="4" rx="1" fill="#eab308"/><rect x="5" y="8" width="4" height="8" rx="1" fill="#eab308"/><rect x="10" y="4" width="4" height="12" rx="1" fill="#d1ccc3"/><rect x="15" y="0" width="4" height="16" rx="1" fill="#d1ccc3"/></svg><span class="signal-text">æ™®é€š</span></td>
              <td><svg class="meter-svg" width="18" height="18" viewBox="0 0 36 36"><circle cx="18" cy="18" r="15" fill="none" stroke="#e5e2dc" stroke-width="4"/><circle cx="18" cy="18" r="15" fill="none" stroke="#22c55e" stroke-width="4" stroke-dasharray="94.2" stroke-dashoffset="2.8" transform="rotate(-90 18 18)" stroke-linecap="round"/></svg><span class="meter-text">97%</span></td>
              <td><button class="action-btn" onclick="showDetailModal('C4M8P2')">è©³ç´°</button><button class="action-btn delete-btn" onclick="confirmDelete('C4M8P2')">å‰Šé™¤</button></td>
            </tr>
            <tr>
              <td><span class="status-badge"><span class="status-dot error"></span>è­¦å‘Š</span></td>
              <td><div class="room-cell"><span class="room-number">201</span><span class="room-name">éˆ´æœ¨ ä¸‰éƒ</span></div></td>
              <td class="mono">D9L3Q7</td>
              <td><button class="watch-toggle-sm active" onclick="toggleDeviceWatch(this, 'D9L3Q7')"></button></td>
              <td><span class="time-ago old">26æ™‚é–“å‰</span></td>
              <td><svg class="battery-svg" width="28" height="14" viewBox="0 0 28 14"><rect x="0" y="1" width="24" height="12" rx="2" fill="none" stroke="#16a34a" stroke-width="1.5"/><rect x="2" y="3" width="9" height="8" rx="1" fill="#22c55e"/><rect x="24" y="4" width="3" height="6" rx="1" fill="#16a34a"/></svg><span class="battery-text">45%</span></td>
              <td><svg class="signal-svg" width="20" height="16" viewBox="0 0 20 16"><rect x="0" y="12" width="4" height="4" rx="1" fill="#22c55e"/><rect x="5" y="8" width="4" height="8" rx="1" fill="#22c55e"/><rect x="10" y="4" width="4" height="12" rx="1" fill="#22c55e"/><rect x="15" y="0" width="4" height="16" rx="1" fill="#d1ccc3"/></svg><span class="signal-text">è‰¯å¥½</span></td>
              <td><svg class="meter-svg" width="18" height="18" viewBox="0 0 36 36"><circle cx="18" cy="18" r="15" fill="none" stroke="#e5e2dc" stroke-width="4"/><circle cx="18" cy="18" r="15" fill="none" stroke="#22c55e" stroke-width="4" stroke-dasharray="94.2" stroke-dashoffset="9.4" transform="rotate(-90 18 18)" stroke-linecap="round"/></svg><span class="meter-text">90%</span></td>
              <td><button class="action-btn" onclick="showDetailModal('D9L3Q7')">è©³ç´°</button><button class="action-btn delete-btn" onclick="confirmDelete('D9L3Q7')">å‰Šé™¤</button></td>
            </tr>
            <tr>
              <td><span class="status-badge"><span class="status-dot offline"></span>é›¢ç·š</span></td>
              <td><div class="room-cell"><span class="room-number">202</span><span class="room-name">é«˜æ©‹ å››éƒ</span></div></td>
              <td class="mono">E2P7R4</td>
              <td><button class="watch-toggle-sm disabled"></button></td>
              <td><span class="time-ago old">3æ—¥å‰</span></td>
              <td><span class="battery-text" style="color:var(--gray-400);">-</span></td>
              <td><span class="signal-text" style="color:var(--gray-400);">-</span></td>
              <td><svg class="meter-svg" width="18" height="18" viewBox="0 0 36 36"><circle cx="18" cy="18" r="15" fill="none" stroke="#e5e2dc" stroke-width="4"/><circle cx="18" cy="18" r="15" fill="none" stroke="#eab308" stroke-width="4" stroke-dasharray="94.2" stroke-dashoffset="28.3" transform="rotate(-90 18 18)" stroke-linecap="round"/></svg><span class="meter-text">70%</span></td>
              <td><button class="action-btn" onclick="showDetailModal('E2P7R4')">è©³ç´°</button><button class="action-btn delete-btn" onclick="confirmDelete('E2P7R4')">å‰Šé™¤</button></td>
            </tr>
            <tr>
              <td><span class="status-badge"><span class="status-dot ok"></span>æ­£å¸¸</span></td>
              <td><div class="room-cell"><span class="room-number">203</span><span class="room-name">ä¼Šè—¤ äº”éƒ</span></div></td>
              <td class="mono">F8K2M6</td>
              <td><button class="watch-toggle-sm" onclick="toggleDeviceWatch(this, 'F8K2M6')"></button></td>
              <td><span class="time-ago recent">8åˆ†å‰</span></td>
              <td><svg class="battery-svg" width="28" height="14" viewBox="0 0 28 14"><rect x="0" y="1" width="24" height="12" rx="2" fill="none" stroke="#16a34a" stroke-width="1.5"/><rect x="2" y="3" width="13" height="8" rx="1" fill="#22c55e"/><rect x="24" y="4" width="3" height="6" rx="1" fill="#16a34a"/></svg><span class="battery-text">68%</span></td>
              <td><svg class="signal-svg" width="20" height="16" viewBox="0 0 20 16"><rect x="0" y="12" width="4" height="4" rx="1" fill="#22c55e"/><rect x="5" y="8" width="4" height="8" rx="1" fill="#22c55e"/><rect x="10" y="4" width="4" height="12" rx="1" fill="#22c55e"/><rect x="15" y="0" width="4" height="16" rx="1" fill="#22c55e"/></svg><span class="signal-text">è‰¯å¥½</span></td>
              <td><svg class="meter-svg" width="18" height="18" viewBox="0 0 36 36"><circle cx="18" cy="18" r="15" fill="none" stroke="#e5e2dc" stroke-width="4"/><circle cx="18" cy="18" r="15" fill="none" stroke="#22c55e" stroke-width="4" stroke-dasharray="94.2" stroke-dashoffset="4.7" transform="rotate(-90 18 18)" stroke-linecap="round"/></svg><span class="meter-text">95%</span></td>
              <td><button class="action-btn" onclick="showDetailModal('F8K2M6')">è©³ç´°</button><button class="action-btn delete-btn" onclick="confirmDelete('F8K2M6')">å‰Šé™¤</button></td>
            </tr>
            <tr>
              <td><span class="status-badge"><span class="status-dot warning"></span>æ³¨æ„</span></td>
              <td><div class="room-cell"><span class="room-number">301</span><span class="room-name">æ¸¡è¾º å…­å­</span></div></td>
              <td class="mono">G5N9T1</td>
              <td><button class="watch-toggle-sm active" onclick="toggleDeviceWatch(this, 'G5N9T1')"></button></td>
              <td><span class="time-ago">38åˆ†å‰</span></td>
              <td><svg class="battery-svg" width="28" height="14" viewBox="0 0 28 14"><rect x="0" y="1" width="24" height="12" rx="2" fill="none" stroke="#eab308" stroke-width="1.5"/><rect x="2" y="3" width="7" height="8" rx="1" fill="#eab308"/><rect x="24" y="4" width="3" height="6" rx="1" fill="#eab308"/></svg><span class="battery-text">32%</span></td>
              <td><svg class="signal-svg" width="20" height="16" viewBox="0 0 20 16"><rect x="0" y="12" width="4" height="4" rx="1" fill="#ef4444"/><rect x="5" y="8" width="4" height="8" rx="1" fill="#d1ccc3"/><rect x="10" y="4" width="4" height="12" rx="1" fill="#d1ccc3"/><rect x="15" y="0" width="4" height="16" rx="1" fill="#d1ccc3"/></svg><span class="signal-text">å¼±ã„</span></td>
              <td><svg class="meter-svg" width="18" height="18" viewBox="0 0 36 36"><circle cx="18" cy="18" r="15" fill="none" stroke="#e5e2dc" stroke-width="4"/><circle cx="18" cy="18" r="15" fill="none" stroke="#22c55e" stroke-width="4" stroke-dasharray="94.2" stroke-dashoffset="7.5" transform="rotate(-90 18 18)" stroke-linecap="round"/></svg><span class="meter-text">92%</span></td>
              <td><button class="action-btn" onclick="showDetailModal('G5N9T1')">è©³ç´°</button><button class="action-btn delete-btn" onclick="confirmDelete('G5N9T1')">å‰Šé™¤</button></td>
            </tr>
            <tr>
              <td><span class="status-badge"><span class="status-dot ok"></span>æ­£å¸¸</span></td>
              <td><div class="room-cell"><span class="room-number">302</span><span class="room-name">ä¸­æ‘ ä¸ƒç¾</span></div></td>
              <td class="mono">H1Q4W8</td>
              <td><button class="watch-toggle-sm active" onclick="toggleDeviceWatch(this, 'H1Q4W8')"></button></td>
              <td><span class="time-ago recent">2åˆ†å‰</span></td>
              <td><svg class="battery-svg" width="28" height="14" viewBox="0 0 28 14"><rect x="0" y="1" width="24" height="12" rx="2" fill="none" stroke="#16a34a" stroke-width="1.5"/><rect x="2" y="3" width="18" height="8" rx="1" fill="#22c55e"/><rect x="24" y="4" width="3" height="6" rx="1" fill="#16a34a"/></svg><span class="battery-text">91%</span></td>
              <td><svg class="signal-svg" width="20" height="16" viewBox="0 0 20 16"><rect x="0" y="12" width="4" height="4" rx="1" fill="#22c55e"/><rect x="5" y="8" width="4" height="8" rx="1" fill="#22c55e"/><rect x="10" y="4" width="4" height="12" rx="1" fill="#22c55e"/><rect x="15" y="0" width="4" height="16" rx="1" fill="#22c55e"/></svg><span class="signal-text">è‰¯å¥½</span></td>
              <td><svg class="meter-svg" width="18" height="18" viewBox="0 0 36 36"><circle cx="18" cy="18" r="15" fill="none" stroke="#e5e2dc" stroke-width="4"/><circle cx="18" cy="18" r="15" fill="none" stroke="#22c55e" stroke-width="4" stroke-dasharray="94.2" stroke-dashoffset="0.9" transform="rotate(-90 18 18)" stroke-linecap="round"/></svg><span class="meter-text">99%</span></td>
              <td><button class="action-btn" onclick="showDetailModal('H1Q4W8')">è©³ç´°</button><button class="action-btn delete-btn" onclick="confirmDelete('H1Q4W8')">å‰Šé™¤</button></td>
            </tr>
            <tr>
              <td><span class="status-badge"><span class="status-dot vacant"></span>ç©ºå®¤</span></td>
              <td><div class="room-cell"><span class="room-number">303</span><span class="room-name">-</span></div></td>
              <td class="mono" style="color:var(--gray-400);">-</td>
              <td><button class="watch-toggle-sm disabled"></button></td>
              <td><span class="time-ago" style="color:var(--gray-400);">-</span></td>
              <td><span class="battery-text" style="color:var(--gray-400);">-</span></td>
              <td><span class="signal-text" style="color:var(--gray-400);">-</span></td>
              <td><span class="meter-text" style="color:var(--gray-400);">-</span></td>
              <td><button class="action-btn" onclick="showAddDeviceModal('303')">è¨­ç½®</button></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="pagination">
        <span class="pagination-info">1ã€œ9ä»¶ / å…¨45ä»¶</span>
        <div class="pagination-buttons">
          <button class="page-btn" disabled>â€¹</button>
          <button class="page-btn active">1</button>
          <button class="page-btn">2</button>
          <button class="page-btn">3</button>
          <button class="page-btn">4</button>
          <button class="page-btn">5</button>
          <button class="page-btn">â€º</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="addDeviceModal" class="modal-overlay" onclick="if(event.target===this)hideAddDeviceModal()">
    <div class="modal">
      <div class="modal-header">
        <h3>â• ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ </h3>
        <button class="modal-close" onclick="hideAddDeviceModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">ãƒ‡ãƒã‚¤ã‚¹ID</label>
          <input type="text" class="form-input" id="addDeviceId" placeholder="A3K9X2" maxlength="6" style="text-transform:uppercase;letter-spacing:0.1em;">
          <p class="form-hint">è£½å“ãƒ©ãƒ™ãƒ«ã«è¨˜è¼‰ã®6æ–‡å­—</p>
        </div>
        <div class="form-group">
          <label class="form-label">éƒ¨å±‹ç•ªå·</label>
          <input type="text" class="form-input" id="addDeviceRoom" placeholder="101">
        </div>
        <div class="form-group">
          <label class="form-label">å…¥å±…è€…åï¼ˆä»»æ„ï¼‰</label>
          <input type="text" class="form-input" id="addDeviceName" placeholder="å±±ç”° å¤ªéƒ">
        </div>
        <div class="form-group">
          <label class="form-label">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
          <input type="text" class="form-input" id="addDeviceMemo" placeholder="æ¯å­ãŒç·Šæ€¥é€£çµ¡å…ˆ">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideAddDeviceModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" onclick="addDevice()">è¿½åŠ </button>
      </div>
    </div>
  </div>

  <!-- å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="deleteModal" class="modal-overlay" onclick="if(event.target===this)hideDeleteModal()">
    <div class="modal">
      <div class="modal-header">
        <h3>âš ï¸ ãƒ‡ãƒã‚¤ã‚¹å‰Šé™¤</h3>
        <button class="modal-close" onclick="hideDeleteModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="font-size:14px;color:var(--gray-700);line-height:1.8;">
          ãƒ‡ãƒã‚¤ã‚¹ <strong id="deleteDeviceId" style="font-family:monospace;">A3K9X2</strong> ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ<br>
          ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideDeleteModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-danger" onclick="executeDelete()">å‰Šé™¤ã™ã‚‹</button>
      </div>
    </div>
  </div>

  <!-- ã‚¿ã‚¤ãƒãƒ¼ä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="timerListModal" class="modal-overlay" onclick="if(event.target===this)hideTimerListModal()">
    <div class="modal wide">
      <div class="modal-header">
        <h3>â° ã‚¿ã‚¤ãƒãƒ¼è¨­å®šä¸€è¦§</h3>
        <button class="modal-close" onclick="hideTimerListModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="font-size:13px;color:var(--gray-600);margin-bottom:16px;">ã‚¿ã‚¤ãƒãƒ¼è¨­å®šä¸­ã®ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§ã§ã™ã€‚åœæ­¢ä¸­ã¾ãŸã¯åœæ­¢äºˆå®šã®ãƒ‡ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        
        <ul class="timer-list" id="timerListContent">
          <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
        </ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideTimerListModal()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <!-- è¦‹å®ˆã‚ŠON/OFFç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="watchToggleModal" class="modal-overlay" onclick="if(event.target===this)hideWatchToggleModal()">
    <div class="modal">
      <div class="modal-header">
        <h3 id="watchToggleTitle">âš ï¸ è¦‹å®ˆã‚Šã‚’OFFã«ã—ã¾ã™ã‹ï¼Ÿ</h3>
        <button class="modal-close" onclick="hideWatchToggleModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p id="watchToggleMessage" style="font-size:14px;color:var(--gray-700);line-height:1.8;">
          <!-- å‹•çš„ã«å†…å®¹ãŒå…¥ã‚‹ -->
        </p>
        <div id="watchToggleWarning" class="watch-warning" style="margin-top:16px;padding:14px;background:var(--yellow-light);border:1px solid #fde68a;border-radius:var(--radius);display:none;">
          <p style="font-size:13px;color:var(--gray-700);"><strong>âš ï¸ æ³¨æ„:</strong> OFFã«ã™ã‚‹ã¨ã€ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã®æœªæ¤œçŸ¥ã‚¢ãƒ©ãƒ¼ãƒˆãŒé€ä¿¡ã•ã‚Œãªããªã‚Šã¾ã™ã€‚</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideWatchToggleModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn" id="watchToggleConfirmBtn" onclick="confirmWatchToggle()">OFFã«ã™ã‚‹</button>
      </div>
    </div>
  </div>

  <!-- è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="detailModal" class="modal-overlay" onclick="if(event.target===this)hideDetailModal()">
    <div class="modal wide">
      <div class="modal-header">
        <h3>ğŸ“‹ ãƒ‡ãƒã‚¤ã‚¹è©³ç´°</h3>
        <button class="modal-close" onclick="hideDetailModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
        <div class="status-large" id="detailStatus">
          <span class="status-large-dot"></span>
          <span class="status-large-text" id="detailStatusText">æ­£å¸¸ç¨¼åƒä¸­</span>
        </div>

        <!-- åŸºæœ¬æƒ…å ± -->
        <div class="detail-grid">
          <div class="detail-item">
            <p class="detail-item-label">ãƒ‡ãƒã‚¤ã‚¹ID</p>
            <p class="detail-item-value mono" id="detailDeviceId">A3K9X2</p>
          </div>
          <div class="detail-item">
            <p class="detail-item-label">éƒ¨å±‹ç•ªå·</p>
            <p class="detail-item-value" id="detailRoom">101</p>
          </div>
          <div class="detail-item">
            <p class="detail-item-label">å…¥å±…è€…å</p>
            <p class="detail-item-value" id="detailName">å±±ç”° å¤ªéƒ</p>
          </div>
          <div class="detail-item">
            <p class="detail-item-label">æœ€çµ‚æ¤œçŸ¥</p>
            <p class="detail-item-value ok" id="detailLastDetect">3åˆ†å‰</p>
          </div>
        </div>

        <!-- ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹ -->
        <div class="detail-section">
          <h4 class="detail-section-title"><span>ğŸ“Š ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹</span></h4>
          <div class="detail-grid">
            <div class="detail-item">
              <p class="detail-item-label">é›»æ± æ®‹é‡</p>
              <p class="detail-item-value ok" id="detailBattery">85%</p>
            </div>
            <div class="detail-item">
              <p class="detail-item-label">é›»æ³¢å¼·åº¦</p>
              <p class="detail-item-value ok" id="detailSignal">è‰¯å¥½ (-65dBm)</p>
            </div>
            <div class="detail-item">
              <p class="detail-item-label">é€šä¿¡æ®‹é‡</p>
              <p class="detail-item-value" id="detailData">99% (495MB)</p>
            </div>
            <div class="detail-item">
              <p class="detail-item-label">ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢</p>
              <p class="detail-item-value" id="detailFirmware">v1.2.3</p>
            </div>
          </div>
        </div>

        <!-- è¦‹å®ˆã‚Šè¨­å®š -->
        <div class="detail-section">
          <h4 class="detail-section-title"><span>âš™ï¸ è¦‹å®ˆã‚Šè¨­å®š</span></h4>
          <div class="detail-row">
            <span class="detail-row-label">è¦‹å®ˆã‚ŠON/OFF</span>
            <div style="display:flex;align-items:center;gap:12px;">
              <span class="detail-row-value" id="detailWatchStatus">ON</span>
              <button class="watch-toggle-sm active" id="detailWatchToggle" onclick="toggleDetailWatch()"></button>
            </div>
          </div>
          <div class="detail-row">
            <span class="detail-row-label">ã‚¢ãƒ©ãƒ¼ãƒˆæ™‚é–“</span>
            <span class="detail-row-value" id="detailAlertHours">24æ™‚é–“</span>
          </div>
          <div class="detail-row">
            <span class="detail-row-label">è¨­ç½®é«˜ã•</span>
            <span class="detail-row-value" id="detailHeight">200cm</span>
          </div>
          <div class="detail-row">
            <span class="detail-row-label">ãƒšãƒƒãƒˆé™¤å¤–</span>
            <span class="detail-row-value" id="detailPetExclude">ONï¼ˆ100cmä»¥ä¸‹ã‚’é™¤å¤–ï¼‰</span>
          </div>
        </div>

        <!-- ã‚¿ã‚¤ãƒãƒ¼è¨­å®š -->
        <div class="detail-section" id="detailTimerSection">
          <h4 class="detail-section-title">
            <span>â° ã‚¿ã‚¤ãƒãƒ¼è¨­å®š</span>
            <button class="btn-add-sm" onclick="showAddTimerModal()">â• è¿½åŠ </button>
          </h4>
          <div id="detailTimerList">
            <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
          </div>
        </div>

        <!-- ç™»éŒ²æƒ…å ± -->
        <div class="detail-section">
          <h4 class="detail-section-title"><span>ğŸ“ ç™»éŒ²æƒ…å ±</span></h4>
          <div class="detail-row">
            <span class="detail-row-label">ç™»éŒ²æ—¥</span>
            <span class="detail-row-value" id="detailRegDate">2024/06/15</span>
          </div>
          <div class="detail-row">
            <span class="detail-row-label">ãƒ¡ãƒ¢</span>
            <span class="detail-row-value" id="detailMemo">æ¯å­ãŒç·Šæ€¥é€£çµ¡å…ˆ</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideDetailModal()">é–‰ã˜ã‚‹</button>
        <button class="btn btn-primary" onclick="editDevice()">ç·¨é›†</button>
      </div>
    </div>
  </div>

  <!-- ã‚¿ã‚¤ãƒãƒ¼è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="addTimerModal" class="modal-overlay" onclick="if(event.target===this)hideAddTimerModal()">
    <div class="modal wide">
      <div class="modal-header">
        <h3>â° ã‚¿ã‚¤ãƒãƒ¼è¿½åŠ </h3>
        <button class="modal-close" onclick="hideAddTimerModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="font-size:13px;color:var(--gray-600);margin-bottom:16px;">
          <strong id="addTimerTargetRoom">101</strong>å·å®¤ <strong id="addTimerTargetName">å±±ç”° å¤ªéƒ</strong>ï¼ˆ<span id="addTimerTargetId" style="font-family:monospace;">A3K9X2</span>ï¼‰
        </p>
        
        <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="timer-tabs">
          <button class="timer-tab active" onclick="switchAddTimerTab('oneshot')">ğŸ“… å˜ç™ºã®äºˆå®š</button>
          <button class="timer-tab" onclick="switchAddTimerTab('recurring')">ğŸ” å®šæœŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</button>
        </div>
        
        <!-- å˜ç™ºã®äºˆå®šã‚¿ãƒ– -->
        <div id="addOneshotTab" class="timer-content active">
          <div class="form-group">
            <label class="form-label">åœæ­¢é–‹å§‹</label>
            <input type="datetime-local" class="form-input" id="addOneshotStart">
          </div>
          <div class="form-group">
            <label class="form-label">è‡ªå‹•å†é–‹</label>
            <input type="datetime-local" class="form-input" id="addOneshotEnd">
            <p class="form-hint">ç©ºæ¬„ã®å ´åˆã¯æ‰‹å‹•ã§ONã«æˆ»ã™å¿…è¦ãŒã‚ã‚Šã¾ã™</p>
          </div>
          <div class="form-group">
            <label class="form-label">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
            <input type="text" class="form-input" id="addOneshotMemo" placeholder="æ—…è¡Œã€å…¥é™¢ãªã©">
          </div>
        </div>
        
        <!-- å®šæœŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ãƒ– -->
        <div id="addRecurringTab" class="timer-content">
          <div class="form-group">
            <label class="form-label">æ›œæ—¥ã‚’é¸æŠ</label>
            <div class="weekday-selector" id="addWeekdaySelector">
              <button type="button" class="weekday-btn sun" data-day="0">æ—¥</button>
              <button type="button" class="weekday-btn" data-day="1">æœˆ</button>
              <button type="button" class="weekday-btn" data-day="2">ç«</button>
              <button type="button" class="weekday-btn" data-day="3">æ°´</button>
              <button type="button" class="weekday-btn" data-day="4">æœ¨</button>
              <button type="button" class="weekday-btn" data-day="5">é‡‘</button>
              <button type="button" class="weekday-btn sat" data-day="6">åœŸ</button>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">æ™‚é–“å¸¯</label>
            <div class="time-row">
              <input type="time" id="addRecurringStart" value="10:00">
              <span>ã€œ</span>
              <input type="time" id="addRecurringEnd" value="16:00">
            </div>
            <div class="checkbox-row">
              <input type="checkbox" id="addRecurringNextDay">
              <label for="addRecurringNextDay">ç¿Œæ—¥ã¾ã§ã¾ãŸã</label>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
            <input type="text" class="form-input" id="addRecurringMemo" placeholder="ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ã€é€šé™¢ãªã©">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideAddTimerModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" onclick="saveTimer()">è¿½åŠ ã™ã‚‹</button>
      </div>
    </div>
  </div>

  <script>
// Cookieç®¡ç†
function setCookie(n,v,d){const e=new Date();e.setTime(e.getTime()+d*24*60*60*1000);document.cookie=n+'='+v+';expires='+e.toUTCString()+';path=/';}
function getCookie(n){const c=document.cookie.split(';');for(let i=0;i<c.length;i++){let x=c[i].trim();if(x.indexOf(n+'=')===0)return x.substring(n.length+1);}return null;}

// ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥
function showToast(message) {
  const toast = document.getElementById('toast');
  document.getElementById('toastText').textContent = message;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// PWAãƒãƒŠãƒ¼
function closePwaBanner(){document.getElementById('pwaBanner').classList.add('hidden');setCookie('pwa_banner_closed','1',30);}
(function(){if(getCookie('pwa_banner_closed')==='1'){document.getElementById('pwaBanner').classList.add('hidden');}})();

// ãƒ‡ãƒã‚¤ã‚¹ãƒ‡ãƒ¼ã‚¿
const deviceData = {
  'A3K9X2': { room: '101', name: 'å±±ç”° å¤ªéƒ', status: 'ok', statusText: 'æ­£å¸¸ç¨¼åƒä¸­', lastDetect: '3åˆ†å‰', battery: '85%', signal: 'è‰¯å¥½ (-65dBm)', data: '99% (495MB)', firmware: 'v1.2.3', watch: 'ON', alertHours: '24æ™‚é–“', height: '200cm', petExclude: 'ONï¼ˆ100cmä»¥ä¸‹ã‚’é™¤å¤–ï¼‰', regDate: '2024/06/15', memo: 'æ¯å­ãŒç·Šæ€¥é€£çµ¡å…ˆ', timers: [] },
  'B7X2K9': { room: '102', name: 'ä½è—¤ èŠ±å­', status: 'ok', statusText: 'æ­£å¸¸ç¨¼åƒä¸­', lastDetect: '5åˆ†å‰', battery: '72%', signal: 'è‰¯å¥½ (-68dBm)', data: '98% (490MB)', firmware: 'v1.2.3', watch: 'OFF', alertHours: '24æ™‚é–“', height: '195cm', petExclude: 'ONï¼ˆ90cmä»¥ä¸‹ã‚’é™¤å¤–ï¼‰', regDate: '2024/07/01', memo: 'æ¯å­ã¨åŒå±…', timers: [
    { type: 'recurring', schedule: 'æ¯é€± æœˆãƒ»æœ¨ 10:00ã€œ16:00', memo: 'ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹' },
    { type: 'recurring', schedule: 'æ¯é€± åœŸ 09:00ã€œç¿Œ18:00', memo: 'æ¯å­å®…è¨ªå•' }
  ] },
  'C4M8P2': { room: '103', name: 'ç”°ä¸­ æ¬¡éƒ', status: 'warning', statusText: 'é›»æ± æ®‹é‡ä½ä¸‹', lastDetect: '45åˆ†å‰', battery: '28%', signal: 'æ™®é€š (-78dBm)', data: '97% (485MB)', firmware: 'v1.2.3', watch: 'ON', alertHours: '24æ™‚é–“', height: '200cm', petExclude: 'OFF', regDate: '2024/05/20', memo: 'çŒ«1åŒ¹', timers: [] },
  'D9L3Q7': { room: '201', name: 'éˆ´æœ¨ ä¸‰éƒ', status: 'error', statusText: '26æ™‚é–“æ¤œçŸ¥ãªã—', lastDetect: '26æ™‚é–“å‰', battery: '45%', signal: 'è‰¯å¥½ (-70dBm)', data: '90% (450MB)', firmware: 'v1.2.3', watch: 'ON', alertHours: '24æ™‚é–“', height: '205cm', petExclude: 'OFF', regDate: '2024/04/10', memo: 'å¨˜ãŒç·Šæ€¥é€£çµ¡å…ˆ', timers: [
    { type: 'oneshot', schedule: '1/25 09:00 ã€œ 1/28 18:00', memo: 'æ¸©æ³‰æ—…è¡Œ' }
  ] },
  'E2P7R4': { room: '202', name: 'é«˜æ©‹ å››éƒ', status: 'offline', statusText: 'é€šä¿¡é€”çµ¶ï¼ˆ3æ—¥ï¼‰', lastDetect: '3æ—¥å‰', battery: '-', signal: '-', data: '70% (350MB)', firmware: 'v1.2.2', watch: '-', alertHours: '24æ™‚é–“', height: '200cm', petExclude: 'OFF', regDate: '2024/03/01', memo: 'é›»æ³¢éšœå®³ã®å¯èƒ½æ€§', timers: [
    { type: 'oneshot', schedule: '2/1 ã€œ æœªå®šï¼ˆæ‰‹å‹•å¾©å¸°ï¼‰', memo: 'å…¥é™¢äºˆå®š' }
  ] },
  'F8K2M6': { room: '203', name: 'ä¼Šè—¤ äº”éƒ', status: 'ok', statusText: 'è¦‹å®ˆã‚Šåœæ­¢ä¸­', lastDetect: '8åˆ†å‰', battery: '68%', signal: 'è‰¯å¥½ (-72dBm)', data: '95% (475MB)', firmware: 'v1.2.3', watch: 'OFF', alertHours: '48æ™‚é–“', height: '210cm', petExclude: 'ONï¼ˆ80cmä»¥ä¸‹ã‚’é™¤å¤–ï¼‰', regDate: '2024/08/15', memo: 'æ—…è¡Œä¸­ï¼ˆ1/20ã¾ã§ï¼‰', timers: [] },
  'G5N9T1': { room: '301', name: 'æ¸¡è¾º å…­å­', status: 'warning', statusText: 'é›»æ± æ®‹é‡ä½ä¸‹ãƒ»é›»æ³¢å¼±ã„', lastDetect: '38åˆ†å‰', battery: '32%', signal: 'å¼±ã„ (-85dBm)', data: '92% (460MB)', firmware: 'v1.2.3', watch: 'ON', alertHours: '24æ™‚é–“', height: '190cm', petExclude: 'OFF', regDate: '2024/06/01', memo: '-', timers: [] },
  'H1Q4W8': { room: '302', name: 'ä¸­æ‘ ä¸ƒç¾', status: 'ok', statusText: 'æ­£å¸¸ç¨¼åƒä¸­', lastDetect: '2åˆ†å‰', battery: '91%', signal: 'è‰¯å¥½ (-62dBm)', data: '99% (495MB)', firmware: 'v1.2.3', watch: 'ON', alertHours: '12æ™‚é–“', height: '185cm', petExclude: 'ONï¼ˆ70cmä»¥ä¸‹ã‚’é™¤å¤–ï¼‰', regDate: '2024/09/01', memo: 'ç‹¬å±…', timers: [] }
};

// ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«
function showAddDeviceModal(roomNum) {
  document.getElementById('addDeviceId').value = '';
  document.getElementById('addDeviceRoom').value = roomNum || '';
  document.getElementById('addDeviceName').value = '';
  document.getElementById('addDeviceMemo').value = '';
  document.getElementById('addDeviceModal').classList.add('show');
}
function hideAddDeviceModal() { document.getElementById('addDeviceModal').classList.remove('show'); }

function addDevice() {
  const deviceId = document.getElementById('addDeviceId').value.toUpperCase().trim();
  const room = document.getElementById('addDeviceRoom').value.trim();
  const name = document.getElementById('addDeviceName').value.trim() || '-';
  const memo = document.getElementById('addDeviceMemo').value.trim() || '-';
  
  if (!deviceId || deviceId.length !== 6) {
    alert('ãƒ‡ãƒã‚¤ã‚¹IDã‚’6æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  if (!room) {
    alert('éƒ¨å±‹ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  if (deviceData[deviceId]) {
    alert('ã“ã®ãƒ‡ãƒã‚¤ã‚¹IDã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
    return;
  }
  
  // ãƒ‡ãƒã‚¤ã‚¹ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
  deviceData[deviceId] = {
    room: room, name: name, status: 'ok', statusText: 'æ­£å¸¸ç¨¼åƒä¸­',
    lastDetect: 'ãŸã£ãŸä»Š', battery: '100%', signal: 'è‰¯å¥½ (-65dBm)',
    data: '100% (500MB)', firmware: 'v1.2.3', watch: 'ON',
    alertHours: '24æ™‚é–“', height: '200cm', petExclude: 'OFF',
    regDate: new Date().toLocaleDateString('ja-JP').replace(/\//g, '/'),
    memo: memo, timers: []
  };
  
  // ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
  const countEl = document.getElementById('deviceCountNum');
  countEl.textContent = parseInt(countEl.textContent) + 1;
  
  hideAddDeviceModal();
  showToast(`ãƒ‡ãƒã‚¤ã‚¹ ${deviceId} ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
  
  // å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†æç”»
  console.log('Added device:', deviceId, deviceData[deviceId]);
}

// å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«
let deleteTargetId = '';
function confirmDelete(deviceId) {
  deleteTargetId = deviceId;
  document.getElementById('deleteDeviceId').textContent = deviceId;
  document.getElementById('deleteModal').classList.add('show');
}
function hideDeleteModal() { document.getElementById('deleteModal').classList.remove('show'); }
function executeDelete() {
  if (deleteTargetId && deviceData[deleteTargetId]) {
    delete deviceData[deleteTargetId];
    const countEl = document.getElementById('deviceCountNum');
    countEl.textContent = parseInt(countEl.textContent) - 1;
    showToast(`ãƒ‡ãƒã‚¤ã‚¹ ${deleteTargetId} ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
  }
  hideDeleteModal();
  deleteTargetId = '';
}

// è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«
let currentDetailDeviceId = '';

function showDetailModal(deviceId) {
  const data = deviceData[deviceId];
  if (!data) return;
  
  currentDetailDeviceId = deviceId;
  
  document.getElementById('detailDeviceId').textContent = deviceId;
  document.getElementById('detailRoom').textContent = data.room;
  document.getElementById('detailName').textContent = data.name;
  document.getElementById('detailStatusText').textContent = data.statusText;
  document.getElementById('detailLastDetect').textContent = data.lastDetect;
  document.getElementById('detailBattery').textContent = data.battery;
  document.getElementById('detailSignal').textContent = data.signal;
  document.getElementById('detailData').textContent = data.data;
  document.getElementById('detailFirmware').textContent = data.firmware;
  document.getElementById('detailWatchStatus').textContent = data.watch;
  document.getElementById('detailAlertHours').textContent = data.alertHours;
  document.getElementById('detailHeight').textContent = data.height;
  document.getElementById('detailPetExclude').textContent = data.petExclude;
  document.getElementById('detailRegDate').textContent = data.regDate;
  document.getElementById('detailMemo').textContent = data.memo;
  
  const statusEl = document.getElementById('detailStatus');
  statusEl.className = 'status-large ' + data.status;
  
  const lastDetectEl = document.getElementById('detailLastDetect');
  lastDetectEl.className = 'detail-item-value';
  if (data.status === 'ok') lastDetectEl.classList.add('ok');
  else if (data.status === 'error') lastDetectEl.classList.add('error');
  
  // è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒˆã‚°ãƒ«çŠ¶æ…‹ã‚’è¨­å®š
  const detailToggle = document.getElementById('detailWatchToggle');
  if (data.watch === 'ON') {
    detailToggle.classList.add('active');
    detailToggle.classList.remove('disabled');
  } else if (data.watch === 'OFF') {
    detailToggle.classList.remove('active');
    detailToggle.classList.remove('disabled');
  } else {
    detailToggle.classList.remove('active');
    detailToggle.classList.add('disabled');
  }
  
  // ã‚¿ã‚¤ãƒãƒ¼è¨­å®šè¡¨ç¤º
  renderDetailTimerList(data.timers);
  
  document.getElementById('detailModal').classList.add('show');
}

function renderDetailTimerList(timers) {
  const timerList = document.getElementById('detailTimerList');
  if (!timers || timers.length === 0) {
    timerList.innerHTML = '<p style="font-size:13px;color:var(--gray-400);padding:8px 0;">è¨­å®šãªã—</p>';
    return;
  }
  
  timerList.innerHTML = timers.map((t, i) => `
    <div class="timer-item">
      <div class="timer-item-info">
        <span class="timer-item-type">${t.type === 'recurring' ? 'ğŸ” å®šæœŸ' : 'ğŸ“… å˜ç™º'}</span>
        <p class="timer-item-schedule">${t.schedule}</p>
        <p class="timer-item-memo">${t.memo || ''}</p>
      </div>
      <button class="timer-item-delete" onclick="deleteTimerFromDetail(${i})" title="å‰Šé™¤">Ã—</button>
    </div>
  `).join('');
}

function hideDetailModal() { document.getElementById('detailModal').classList.remove('show'); }

function toggleDetailWatch() {
  const detailToggle = document.getElementById('detailWatchToggle');
  if (detailToggle.classList.contains('disabled')) return;
  
  const data = deviceData[currentDetailDeviceId];
  if (!data) return;
  
  const currentlyOn = detailToggle.classList.contains('active');
  
  pendingToggle = {
    btn: detailToggle,
    deviceId: currentDetailDeviceId,
    room: data.room,
    name: data.name,
    currentState: currentlyOn,
    isFromDetail: true
  };
  
  const title = document.getElementById('watchToggleTitle');
  const message = document.getElementById('watchToggleMessage');
  const warning = document.getElementById('watchToggleWarning');
  const confirmBtn = document.getElementById('watchToggleConfirmBtn');
  
  if (currentlyOn) {
    title.textContent = 'âš ï¸ è¦‹å®ˆã‚Šã‚’OFFã«ã—ã¾ã™ã‹ï¼Ÿ';
    message.innerHTML = `<strong>${data.room}å·å®¤ ${data.name}</strong>ï¼ˆ<span style="font-family:monospace;">${currentDetailDeviceId}</span>ï¼‰ã®è¦‹å®ˆã‚Šã‚’OFFã«ã—ã¾ã™ã‹ï¼Ÿ`;
    warning.style.display = 'block';
    confirmBtn.textContent = 'OFFã«ã™ã‚‹';
    confirmBtn.className = 'btn btn-danger';
  } else {
    title.textContent = 'âœ“ è¦‹å®ˆã‚Šã‚’ONã«ã—ã¾ã™ã‹ï¼Ÿ';
    message.innerHTML = `<strong>${data.room}å·å®¤ ${data.name}</strong>ï¼ˆ<span style="font-family:monospace;">${currentDetailDeviceId}</span>ï¼‰ã®è¦‹å®ˆã‚Šã‚’å†é–‹ã—ã¾ã™ã‹ï¼Ÿ`;
    warning.style.display = 'none';
    confirmBtn.textContent = 'ONã«ã™ã‚‹';
    confirmBtn.className = 'btn btn-success';
  }
  
  document.getElementById('watchToggleModal').classList.add('show');
}

function editDevice() {
  alert('ç·¨é›†ç”»é¢ã«é·ç§»ã—ã¾ã™ï¼ˆå®Ÿè£…äºˆå®šï¼‰');
  hideDetailModal();
}

// è¦‹å®ˆã‚Šãƒˆã‚°ãƒ« - ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
let pendingToggle = { btn: null, deviceId: '', room: '', name: '', currentState: false, isFromDetail: false };

function toggleDeviceWatch(btn, deviceId) {
  if (btn.classList.contains('disabled')) return;
  
  const data = deviceData[deviceId];
  if (!data) return;
  
  const currentlyOn = btn.classList.contains('active');
  pendingToggle = {
    btn: btn,
    deviceId: deviceId,
    room: data.room,
    name: data.name,
    currentState: currentlyOn,
    isFromDetail: false
  };
  
  const title = document.getElementById('watchToggleTitle');
  const message = document.getElementById('watchToggleMessage');
  const warning = document.getElementById('watchToggleWarning');
  const confirmBtn = document.getElementById('watchToggleConfirmBtn');
  
  if (currentlyOn) {
    title.textContent = 'âš ï¸ è¦‹å®ˆã‚Šã‚’OFFã«ã—ã¾ã™ã‹ï¼Ÿ';
    message.innerHTML = `<strong>${data.room}å·å®¤ ${data.name}</strong>ï¼ˆ<span style="font-family:monospace;">${deviceId}</span>ï¼‰ã®è¦‹å®ˆã‚Šã‚’OFFã«ã—ã¾ã™ã‹ï¼Ÿ`;
    warning.style.display = 'block';
    confirmBtn.textContent = 'OFFã«ã™ã‚‹';
    confirmBtn.className = 'btn btn-danger';
  } else {
    title.textContent = 'âœ“ è¦‹å®ˆã‚Šã‚’ONã«ã—ã¾ã™ã‹ï¼Ÿ';
    message.innerHTML = `<strong>${data.room}å·å®¤ ${data.name}</strong>ï¼ˆ<span style="font-family:monospace;">${deviceId}</span>ï¼‰ã®è¦‹å®ˆã‚Šã‚’å†é–‹ã—ã¾ã™ã‹ï¼Ÿ`;
    warning.style.display = 'none';
    confirmBtn.textContent = 'ONã«ã™ã‚‹';
    confirmBtn.className = 'btn btn-success';
  }
  
  document.getElementById('watchToggleModal').classList.add('show');
}

function hideWatchToggleModal() {
  document.getElementById('watchToggleModal').classList.remove('show');
  pendingToggle = { btn: null, deviceId: '', room: '', name: '', currentState: false, isFromDetail: false };
}

function confirmWatchToggle() {
  if (pendingToggle.btn) {
    pendingToggle.btn.classList.toggle('active');
    const isOn = pendingToggle.btn.classList.contains('active');
    
    // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
    if (deviceData[pendingToggle.deviceId]) {
      deviceData[pendingToggle.deviceId].watch = isOn ? 'ON' : 'OFF';
    }
    
    if (pendingToggle.isFromDetail) {
      const tableToggles = document.querySelectorAll('table .watch-toggle-sm');
      tableToggles.forEach(toggle => {
        const row = toggle.closest('tr');
        const deviceIdCell = row.querySelector('td.mono');
        if (deviceIdCell && deviceIdCell.textContent === pendingToggle.deviceId) {
          if (isOn) toggle.classList.add('active');
          else toggle.classList.remove('active');
        }
      });
      document.getElementById('detailWatchStatus').textContent = isOn ? 'ON' : 'OFF';
    } else {
      if (document.getElementById('detailModal').classList.contains('show') && 
          currentDetailDeviceId === pendingToggle.deviceId) {
        const detailToggle = document.getElementById('detailWatchToggle');
        if (isOn) detailToggle.classList.add('active');
        else detailToggle.classList.remove('active');
        document.getElementById('detailWatchStatus').textContent = isOn ? 'ON' : 'OFF';
      }
    }
    
    showToast(`${pendingToggle.room}å·å®¤ã®è¦‹å®ˆã‚Šã‚’${isOn ? 'ON' : 'OFF'}ã«ã—ã¾ã—ãŸ`);
  }
  hideWatchToggleModal();
}

// ã‚½ãƒ¼ãƒˆ
function sortTable(column) {
  const ths = document.querySelectorAll('th.sortable');
  ths.forEach(th => {
    if (th.onclick.toString().includes(column)) {
      if (th.classList.contains('sorted-asc')) {
        th.classList.remove('sorted-asc');
        th.classList.add('sorted-desc');
        th.querySelector('.sort-icon').textContent = 'â†“';
      } else {
        th.classList.remove('sorted-desc');
        th.classList.add('sorted-asc');
        th.querySelector('.sort-icon').textContent = 'â†‘';
      }
    } else {
      th.classList.remove('sorted-asc', 'sorted-desc');
      th.querySelector('.sort-icon').textContent = 'â†•';
    }
  });
}

// ã‚¿ã‚¤ãƒãƒ¼ä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ«
function showTimerListModal() {
  renderTimerList();
  document.getElementById('timerListModal').classList.add('show');
}
function hideTimerListModal() {
  document.getElementById('timerListModal').classList.remove('show');
}

function renderTimerList() {
  const container = document.getElementById('timerListContent');
  const items = [];
  
  for (const [deviceId, data] of Object.entries(deviceData)) {
    if (data.timers && data.timers.length > 0) {
      data.timers.forEach((timer, idx) => {
        items.push({ deviceId, room: data.room, name: data.name, timer, idx });
      });
    }
  }
  
  if (items.length === 0) {
    container.innerHTML = '<li style="padding:20px;text-align:center;color:var(--gray-400);font-size:13px;">ã‚¿ã‚¤ãƒãƒ¼è¨­å®šãªã—</li>';
    return;
  }
  
  container.innerHTML = items.map(item => `
    <li class="timer-list-item">
      <div class="timer-list-room">
        <p class="timer-list-room-num">${item.room}</p>
        <p class="timer-list-room-name">${item.name}</p>
      </div>
      <div class="timer-list-info">
        <p class="timer-list-schedule">${item.timer.schedule}</p>
        <p class="timer-list-memo">${item.timer.memo || ''}</p>
      </div>
      <span class="timer-list-type ${item.timer.type}">${item.timer.type === 'recurring' ? 'å®šæœŸ' : 'å˜ç™º'}</span>
      <button class="timer-list-delete" onclick="deleteTimerFromList('${item.deviceId}', ${item.idx})" title="å‰Šé™¤">Ã—</button>
    </li>
  `).join('');
}

function deleteTimerFromList(deviceId, idx) {
  if (!confirm('ã“ã®ã‚¿ã‚¤ãƒãƒ¼è¨­å®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  
  if (deviceData[deviceId] && deviceData[deviceId].timers) {
    deviceData[deviceId].timers.splice(idx, 1);
    renderTimerList();
    showToast('ã‚¿ã‚¤ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
  }
}

function deleteTimerFromDetail(idx) {
  if (!confirm('ã“ã®ã‚¿ã‚¤ãƒãƒ¼è¨­å®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  
  const data = deviceData[currentDetailDeviceId];
  if (data && data.timers) {
    data.timers.splice(idx, 1);
    renderDetailTimerList(data.timers);
    showToast('ã‚¿ã‚¤ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
  }
}

// ã‚¿ã‚¤ãƒãƒ¼è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«
let currentAddTimerTab = 'oneshot';

function showAddTimerModal() {
  const data = deviceData[currentDetailDeviceId];
  if (!data) return;
  
  document.getElementById('addTimerTargetRoom').textContent = data.room;
  document.getElementById('addTimerTargetName').textContent = data.name;
  document.getElementById('addTimerTargetId').textContent = currentDetailDeviceId;
  
  // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
  document.getElementById('addOneshotStart').value = '';
  document.getElementById('addOneshotEnd').value = '';
  document.getElementById('addOneshotMemo').value = '';
  document.querySelectorAll('#addWeekdaySelector .weekday-btn').forEach(btn => btn.classList.remove('selected'));
  document.getElementById('addRecurringStart').value = '10:00';
  document.getElementById('addRecurringEnd').value = '16:00';
  document.getElementById('addRecurringNextDay').checked = false;
  document.getElementById('addRecurringMemo').value = '';
  
  // ã‚¿ãƒ–ãƒªã‚»ãƒƒãƒˆ
  currentAddTimerTab = 'oneshot';
  document.querySelectorAll('#addTimerModal .timer-tab').forEach((tab, i) => {
    tab.classList.toggle('active', i === 0);
  });
  document.getElementById('addOneshotTab').classList.add('active');
  document.getElementById('addRecurringTab').classList.remove('active');
  
  document.getElementById('addTimerModal').classList.add('show');
}

function hideAddTimerModal() {
  document.getElementById('addTimerModal').classList.remove('show');
}

function switchAddTimerTab(tab) {
  currentAddTimerTab = tab;
  const tabs = document.querySelectorAll('#addTimerModal .timer-tab');
  tabs[0].classList.toggle('active', tab === 'oneshot');
  tabs[1].classList.toggle('active', tab === 'recurring');
  document.getElementById('addOneshotTab').classList.toggle('active', tab === 'oneshot');
  document.getElementById('addRecurringTab').classList.toggle('active', tab === 'recurring');
}

// æ›œæ—¥ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
document.querySelectorAll('#addWeekdaySelector .weekday-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    this.classList.toggle('selected');
  });
});

const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

function saveTimer() {
  const data = deviceData[currentDetailDeviceId];
  if (!data) return;
  
  if (!data.timers) data.timers = [];
  
  if (currentAddTimerTab === 'oneshot') {
    const start = document.getElementById('addOneshotStart').value;
    const end = document.getElementById('addOneshotEnd').value;
    const memo = document.getElementById('addOneshotMemo').value;
    
    if (!start) {
      alert('é–‹å§‹æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }
    
    const startDate = new Date(start);
    const startStr = `${startDate.getMonth()+1}/${startDate.getDate()} ${String(startDate.getHours()).padStart(2,'0')}:${String(startDate.getMinutes()).padStart(2,'0')}`;
    let endStr = 'æœªå®šï¼ˆæ‰‹å‹•å¾©å¸°ï¼‰';
    if (end) {
      const endDate = new Date(end);
      endStr = `${endDate.getMonth()+1}/${endDate.getDate()} ${String(endDate.getHours()).padStart(2,'0')}:${String(endDate.getMinutes()).padStart(2,'0')}`;
    }
    
    data.timers.push({
      type: 'oneshot',
      schedule: `${startStr} ã€œ ${endStr}`,
      memo: memo
    });
    
  } else {
    const selectedDays = [];
    document.querySelectorAll('#addWeekdaySelector .weekday-btn.selected').forEach(btn => {
      selectedDays.push(parseInt(btn.dataset.day));
    });
    
    if (selectedDays.length === 0) {
      alert('æ›œæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }
    
    const start = document.getElementById('addRecurringStart').value;
    const end = document.getElementById('addRecurringEnd').value;
    const nextDay = document.getElementById('addRecurringNextDay').checked;
    const memo = document.getElementById('addRecurringMemo').value;
    
    if (!start || !end) {
      alert('æ™‚é–“å¸¯ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }
    
    const daysStr = selectedDays.sort().map(d => dayNames[d]).join('ãƒ»');
    const timeStr = nextDay ? `${start}ã€œç¿Œ${end}` : `${start}ã€œ${end}`;
    
    data.timers.push({
      type: 'recurring',
      schedule: `æ¯é€± ${daysStr} ${timeStr}`,
      memo: memo
    });
  }
  
  renderDetailTimerList(data.timers);
  hideAddTimerModal();
  showToast('ã‚¿ã‚¤ãƒãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
}
  </script>
</body>
</html>
